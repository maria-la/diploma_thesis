close all;
clear;
clc;

%Read sound files
[k11,Fs1] = audioread("sound/SI1010.WAV.wav");
[k22,Fs] = audioread("sound/SI1384.WAV.wav");

k1 = resample(k11,10000,Fs1);
k2 = resample(k22,10000,Fs);

%Take same length samples
minLength = 128;
k1 = k1(1:minLength);
k2 = k2(1:minLength);

x1 = [-1,
-0.94,
-0.88,
-0.82,
-0.76,
-0.7,
-0.64,
-0.58,
-0.52,
-0.46,
-0.4,
-0.34,
-0.28,
-0.22,
-0.16,
-0.1,
-0.04,
0.02,
0.08,
0.14,
0.2,
0.26,
0.32,
0.38,
0.44,
0.5,
0.56,
0.62,
0.68,
0.74,
0.8,
0.86,
0.92,
0.98,
-0.96,
-0.9,
-0.84,
-0.78,
-0.72,
-0.66,
-0.6,
-0.54,
-0.48,
-0.42,
-0.36,
-0.3,
-0.24,
-0.18,
-0.12,
-0.06,
0,
0.06,
0.12,
0.18,
0.24,
0.3,
0.36,
0.42,
0.48,
0.54,
0.6,
0.66,
0.72,
0.78,
0.84,
0.9,
0.96,
-0.98,
-0.92,
-0.86,
-0.8,
-0.74,
-0.68
-0.62,
-0.56,
-0.5,
-0.44,
-0.38,
-0.32,
-0.26,
-0.2,
-0.14,
-0.08,
-0.02,
0.04,
0.1,
0.16,
0.22,
0.28,
0.34,
0.4,
0.46,
0.52,
0.58,
0.64,
0.7,
0.76,
0.82,
0.88,
0.94,
-1,
-0.94,
-0.88,
-0.82,
-0.76,
-0.7,
-0.64,
-0.58,
-0.52,
-0.46,
-0.4,
-0.34,
-0.28,
-0.22,
-0.16,
-0.1,
-0.04,
0.02,
0.08,
0.14,
0.2,
0.26,
0.32,
0.38,
0.44,
0.5,
0.56,
0.62];

x2= [1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
-1,
1,
1,
1];


z1 = [
0.381533444
0.431776524
0.482019603
0.532262743
0.582505822
0.632748842
0.682991982
0.733235061
0.783478141
0.833721161
0.883964241
0.93420738
0.984450519
-1.47746074
-1.42721748
-1.37697446
-1.32673144
-1.2764883
-1.22624528
-1.17600214
-1.12575901
-1.07551599
-1.02527297
-0.975029886
-0.924786747
1.63761067
1.68785381
1.73809671
1.78833997
1.83858299
1.88882613
1.93906927
1.98931217
2.03955531
0.41502884
0.46527192
0.515515029
0.565758109
-1.89615297
-1.84591007
-1.79566693
-1.74542379
-1.69518065
-1.64493752
-1.59469461
-1.54445136
-1.49420834
-1.4439652
-1.39372218
-1.34347916
1.21891832
1.26916134
1.31940448
1.3696475
1.41989052
1.47013354
1.5203768
1.57061994
1.62086296
1.67110598
1.72134912
1.77159226
1.82183528
-0.640075982
-0.589832842
-0.539589822
-0.489346713
-2.113873
-2.06362987
-2.01338696
-1.96314394
-1.91290081
-2.38183618
-1.76217139
-1.71192849
0.850468874
0.900712013
0.950955033
1.00119817
1.05144131
1.10168445
1.15192759
1.20217061
1.25241363
1.30265677
1.35289967
1.40314293
1.45338595
-1.00852525
-0.958282173
-0.908039093
-0.857796013
-0.807552934
-0.757309854
-0.707066715
-0.656823695
-0.606580615
-0.556337476
-0.506094396
-2.13062096
0.431776524
0.482019603
0.532262743
0.582505822
0.632748842
0.682991982
0.733235061
0.783478141
0.833721161
0.883964241
0.93420738
0.984450519
1.03469348
-1.42721748
-1.37697446
-1.32673144
-1.2764883
-1.22624528
-1.17600214
-1.12575901
-1.07551599
-1.02527297
-0.975029886
-0.924786747
-0.874543726
1.68785381
1.73809671
1.21891832
];

z2 = [
0.325931817
0.368852884
0.41177395
0.454695046
0.497616112
0.540537119
0.583458245
0.626379251
0.669300377
0.712221324
0.75514245
0.798063517
0.840984583
-1.26214755
-1.21922636
-1.17630529
-1.13338423
-1.09046328
-1.0475421
-1.00462115
-0.961699963
-0.918778896
-0.875857949
-0.832936883
-0.790015757
1.39895844
1.44187963
1.48480058
1.52772176
1.57064271
1.61356378
1.65648496
1.69940591
1.74232697
0.354545891
0.397466928
0.440387994
0.48330909
-1.61982298
-1.57690203
-1.53398085
-1.49105978
-1.44813871
-1.40521765
-1.3622967
-1.3193754
-1.27645445
-1.23353338
-1.14769137
1.04128301
1.08420408
1.12712514
1.17004609
1.21296716
1.2558881
1.29880941
1.34173048
1.38465142
1.42757249
1.47049356
1.51341474
1.55633569
-0.546796441
-0.503875375
-0.460954338
-0.418033242
-1.80581427
-1.7628932
-1.71997213
-1.67705107
-1.63413
-2.03472662
-1.5053668
-1.46244574
0.726528406
0.769449472
0.812370539
0.855291605
0.898212731
0.941133857
0.984054923
1.02697587
1.06989694
1.112818
1.15573895
1.19866025
1.2415812
-0.861550868
-0.818629861
-0.775708795
-0.732787728
-0.689866662
-0.646945655
-0.604024529
-0.561103523
-0.518182456
-0.475261331
-0.432340294
-1.82012129
0.368852884
0.41177395
0.454695046
0.497616112
0.540537119
0.583458245
0.626379251
0.669300377
0.712221324
0.75514245
0.798063517
0.840984583
0.88390559
-1.21922636
-1.17630529
-1.13338423
-1.09046328
-1.0475421
-1.00462115
-1.00462115
-0.918778896
-0.875857949
-0.832936883
-0.790015757
-0.74709475
1.44187963
1.48480058
1.04128301
1.04128301
];

y =  (((x1+x2)/2)+((0.3*x1+0.7*x2)/2))/2;
yk =  (((k1+k2)/2)+((0.3*k1+0.7*k2)/2))/2;

x = fastICA(y', 2);
xk = fastICA(yk', 2);

%normalise signals
z1 = z1/(max(abs(z1))');
z2 = z2/(max(abs(z2))');
x11 = x(1,:)/(max(abs(x(1,:))))';
x22 = x(2,:)/(max(abs(x(2,:))))';
xk11 = xk(1,:)/(max(abs(xk(1,:))))';
xk22 = xk(2,:)/(max(abs(xk(2,:))))';

%snr calculation
v1 = snr(x1',x11);
v2 = snr(x2',x22);

vs1 = snr(x1',z1');
vs2 = snr(x2',z2');

vk1 = snr(k1',xk11);
vk2 = snr(k2',xk11);

% plot
figure(1);
subplot(3,1,1);
plot(x1);
grid on;
legend("Actual source 1");
subplot(3,1,2);
plot(x2);
legend("Actual source 2");
grid on;

subplot(3,1,3);
plot(y);
legend("Mixture in mic");
grid on;



%Plot estimated original signals
figure(2);
subplot(4,1,1);
plot(z1);
grid on;
legend("Estimated source 1 on STM32");
subplot(4,1,2);
plot(z2);
grid on;
legend("Estimated source 2 on STM32");
subplot(4,1,3);
plot(z1);
grid on;
legend("Estimated source 1 in MATLAB");
subplot(4,1,4);
plot(z2);
grid on;
legend("Estimated source 2 in MATLAB");


% plot
figure(3);
subplot(3,1,1);
plot(k1);
grid on;
legend("Actual source 1");
subplot(3,1,2);
plot(k2);
legend("Actual source 2");
grid on;

subplot(3,1,3);
plot(yk);
legend("Mixture in mic 1");
grid on;


%Plot estimated original signals
figure(4);
subplot(2,1,1);
plot(xk11);
grid on;
legend("Estimated source 1 in MATLAB");
subplot(2,1,2);
plot(xk22);
grid on;
legend("Estimated source 2 in MATLAB");
